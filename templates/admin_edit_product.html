{% extends "base.html" %}
{% block content %}
<h2>Edit Product</h2>
<form method="post">
  Title: <input type="text" name="title" value="{{ p.title }}" required><br>
  Price: <input type="number" step="0.01" name="price" value="{{ p.price }}" required><br>
  SKU: <input type="text" name="sku" value="{{ p.variants[0].sku if p.variants else '' }}" required><br>
  <label><input type="checkbox" name="is_active" {% if p.status=='active' %}checked{% endif %}> Active</label><br>
  Stock: <input type="number" name="stock" min="0" value="{{ p.stock or 0 }}"><br>
  Categories (multi-select):<br>
  {% set selected = p.categoryIds or [] %}
  {% for c in categories %}
    <label style="margin-right:16px;">
      <input type="checkbox" name="categories" value="{{ c._id }}" {% if c._id in selected %}checked{% endif %}> {{ c.path }}
    </label>
  {% endfor %}
  <br><button type="submit">Save Changes</button>
</form>

<h3>Images</h3>
<div>
  {% for pair in img_pairs %}
    <div style="display:inline-block;margin:6px;text-align:center;">
      <img src="{{ pair.url }}" style="width:120px;height:120px;object-fit:cover;border:1px solid #ddd;border-radius:6px;display:block;">
      <form method="post" action="{{ url_for('delete_image', product_id=p._id) }}">
        <input type="hidden" name="img" value="{{ pair.id }}">
        <button type="submit" onclick="return confirm('Delete this image?')">Delete</button>
      </form>
    </div>
  {% endfor %}
</div>

<form method="post" action="{{ url_for('upload_images', product_id=p._id) }}" enctype="multipart/form-data">
  <input type="file" name="images" multiple>
  <button type="submit">Upload Images</button>
</form>
{% endblock %}
